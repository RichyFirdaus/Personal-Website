<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistik Nilai - Richy</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <style>
        /* --- CSS CORE --- */
        :root {
            --bg-body: #0a0a0a;
            --bg-card: #161616;
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --accent: #3b82f6;
            --border: #333333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            overflow-x: hidden;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* NAVBAR */
        nav {
            padding: 20px 0;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .nav-wrapper { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-weight: 800; font-size: 1.3rem; color: #fff; text-decoration: none; }
        .menu { display: flex; gap: 20px; list-style: none; }
        .menu a { color: var(--text-muted); text-decoration: none; font-size: 0.9rem; }
        .menu a.active { color: #fff; font-weight: 600; }

        /* HEADER */
        .page-header { padding: 60px 0 30px; text-align: center; }
        .page-header h1 { font-size: 2.5rem; letter-spacing: -1px; margin-bottom: 10px; }
        .page-header p { color: var(--text-muted); }

        /* --- STATS GRID --- */
        .stats-grid {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin-bottom: 50px;
            align-items: stretch;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        /* Header Card untuk Judul & Tombol Toggle */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card h3 { font-size: 1.1rem; font-weight: 600; margin: 0; }

        /* Styles Tombol Toggle */
        .toggle-group {
            display: flex;
            background: #222;
            padding: 3px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .toggle-btn {
            background: transparent;
            border: none;
            color: #888;
            padding: 6px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            transition: 0.3s;
        }

        .toggle-btn.active {
            background: var(--accent);
            color: white;
        }

        .toggle-btn:hover:not(.active) { color: white; }

        /* Wadah Grafik */
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            flex-grow: 1; /* Biar ngisi sisa ruang */
        }

        footer { text-align: center; padding: 40px; color: var(--text-muted); border-top: 1px solid var(--border); }

        /* Responsive */
        @media (max-width: 900px) {
            .stats-grid { flex-direction: column; }
            .chart-container { height: 300px; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="container nav-wrapper">
            <a href="index.html" class="logo">Nama.</a>
            <ul class="menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="projects.html">Karya</a></li>
                <li><a href="stats.html" class="active">Nilai TryOut</a></li>
                <li><a href="diary.html">Diary</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Progres Belajar</h1>
            <p>Klik titik biru pada grafik kiri untuk melihat detail subtes di kanan.</p>
        </div>

        <div class="stats-grid">
            <div class="card">
                <div class="card-header">
                    <h3>Riwayat Skor Total</h3>
                </div>
                <div class="chart-container">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 id="detailTitle">Detail Subtes</h3>
                    <div class="toggle-group">
                        <button class="toggle-btn active" id="btn-radar" onclick="switchChartType('radar')">Radar</button>
                        <button class="toggle-btn" id="btn-bar" onclick="switchChartType('bar')">Bar</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="detailChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <footer>Â© 2026 Richy Firdaus.</footer>

    <script>
        Chart.register(ChartDataLabels);

        let lineChart, detailChart;
        let dataGlobal = [];
        let currentDetailType = 'radar'; // Default awal: Radar
        let activeDataIndex = 0; // Menyimpan index data yang sedang dilihat

        async function init() {
            try {
                const res = await fetch('stats.json');
                dataGlobal = await res.json();
                
                // Set default ke data terakhir
                activeDataIndex = dataGlobal.length - 1; 

                renderLineChart();
                renderDetailChart(); 
            } catch (e) {
                console.error("Gagal memuat data:", e);
            }
        }

        // --- 1. LINE CHART (KIRI) ---
        function renderLineChart() {
            const ctx = document.getElementById('lineChart').getContext('2d');
            const labels = dataGlobal.map(d => d.tryout);
            const scores = dataGlobal.map(d => d.skor);

            lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        data: scores,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#fff',
                        // Trik agar titik aktif terlihat beda
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    // SOLUSI ANGKA TERTUTUP: Tambahkan Padding Layout
                    layout: {
                        padding: {
                            top: 30,    // Ruang ekstra di atas
                            right: 20,  // Ruang ekstra di kanan
                            left: 10,
                            bottom: 10
                        }
                    },
                    onClick: (e) => {
                        const activePoints = lineChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                        if (activePoints.length > 0) {
                            activeDataIndex = activePoints[0].index; // Simpan index yg diklik
                            renderDetailChart(); // Update grafik kanan
                        }
                    },
                    scales: {
                        y: { 
                            grid: { color: '#222' }, 
                            ticks: { color: '#666' },
                            // Opsional: Tambah batas atas manual jika padding belum cukup
                            // suggestedMax: Math.max(...scores) + 50 
                        },
                        x: { grid: { display: false }, ticks: { color: '#666' } }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false },
                        datalabels: {
                            color: '#fff',
                            align: 'top',
                            anchor: 'end', // Jangkar di ujung titik
                            offset: 4,     // Geser sedikit ke atas
                            font: { weight: 'bold' },
                            formatter: Math.round
                        }
                    }
                }
            });
        }

        // --- 2. DETAIL CHART (KANAN - Bisa Radar/Bar) ---
        function switchChartType(type) {
            if (currentDetailType === type) return; // Kalau sama, jangan lakukan apa-apa
            
            currentDetailType = type;
            
            // Update tampilan tombol
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${type}`).classList.add('active');
            
            renderDetailChart(true); // true = Paksa hancurkan chart lama (karena ganti tipe)
        }

        function renderDetailChart(forceRecreate = false) {
            const item = dataGlobal[activeDataIndex];
            const labels = Object.keys(item.detail);
            const values = Object.values(item.detail);

            document.getElementById('detailTitle').innerText = `Detail: ${item.tryout}`;
            const ctx = document.getElementById('detailChart').getContext('2d');

            // Cek apakah chart perlu dihancurkan (jika ganti tipe atau belum ada)
            if (detailChart) {
                if (forceRecreate || detailChart.config.type !== currentDetailType) {
                    detailChart.destroy();
                    detailChart = null;
                }
            }

            // Jika chart sudah ada dan tipenya sama, cukup update datanya (Animasi Halus)
            if (detailChart) {
                detailChart.data.labels = labels;
                detailChart.data.datasets[0].data = values;
                detailChart.update();
                return;
            }

            // --- KONFIGURASI BERDASARKAN TIPE ---
            let config = {};

            if (currentDetailType === 'radar') {
                // === CONFIG RADAR ===
                config = {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: values,
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderColor: '#3b82f6',
                            borderWidth: 2,
                            pointBackgroundColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: { color: '#333' },
                                grid: { color: '#333' },
                                pointLabels: { color: '#aaa', font: { size: 11 } },
                                ticks: { display: false },
                                suggestedMin: 0,
                                suggestedMax: 1000
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            datalabels: {
                                color: '#fff',
                                backgroundColor: 'rgba(0,0,0,0.6)',
                                borderRadius: 4,
                                padding: 3,
                                font: { size: 10 }
                            }
                        }
                    }
                };
            } else {
                // === CONFIG BAR HORIZONTAL ===
                config = {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: values,
                            backgroundColor: '#3b82f6', // Biru solid
                            borderRadius: 4,
                            barPercentage: 0.6
                        }]
                    },
                    options: {
                        indexAxis: 'y', // PENTING: Membuat bar jadi horizontal
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { 
                                grid: { color: '#222' }, 
                                ticks: { color: '#666' },
                                max: 1000 // Skala UTBK mentok 1000
                            },
                            y: { 
                                grid: { display: false }, 
                                ticks: { color: '#fff', font: {weight:'bold'} } 
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            datalabels: {
                                color: '#fff',
                                anchor: 'end',
                                align: 'right', // Angka di kanan batang
                                offset: 4,
                                font: { size: 11, weight: 'bold' }
                            }
                        }
                    }
                };
            }

            // Buat Chart Baru
            detailChart = new Chart(ctx, config);
        }

        init();
    </script>
</body>
</html>
