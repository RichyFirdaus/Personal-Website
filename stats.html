<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistik Nilai - Nama Anda</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <nav>
        <div class="container nav-wrapper">
            <a href="index.html" class="logo">Nama.</a>
            <ul class="menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="projects.html">Karya</a></li>
                <li><a href="stats.html" class="active">Nilai TryOut</a></li>
                <li><a href="diary.html">Diary</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Progres Belajar</h1>
            <p>Klik pada titik grafik garis untuk melihat detail subtes.</p>
        </div>

        <div class="stats-grid">
            
            <div class="card">
                <h3 style="margin-bottom: 20px;">Riwayat Skor Total</h3>
                <div style="height: 300px;">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px;" id="radarTitle">Detail Subtes: Terakhir</h3>
                <div style="height: 300px; display: flex; justify-content: center;">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>

        </div>
    </div>

    <footer>Â© 2026 Richy Firdaus.</footer>

    <script>
        let lineChartInstance = null;
        let radarChartInstance = null;
        let allData = []; // Simpan data global

        async function initCharts() {
            try {
                // Fetch Data
                const response = await fetch('stats.json');
                allData = await response.json();

                // Siapkan Data untuk Line Chart
                const labels = allData.map(d => d.tryout);
                const scores = allData.map(d => d.skor);

                // --- 1. RENDER LINE CHART (Kiri) ---
                const ctxLine = document.getElementById('lineChart').getContext('2d');
                
                // Gradasi Biru
                let gradient = ctxLine.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, 'rgba(59, 130, 246, 0.5)'); 
                gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');   

                lineChartInstance = new Chart(ctxLine, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Total Skor',
                            data: scores,
                            borderColor: '#3b82f6',
                            backgroundColor: gradient,
                            borderWidth: 3,
                            pointBackgroundColor: '#1a1a1a',
                            pointBorderColor: '#3b82f6',
                            pointRadius: 6,
                            pointHoverRadius: 12, // Titik membesar saat dihover
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        onClick: (e) => {
                            // FITUR INTERAKTIF: KLIK TITIK
                            const points = lineChartInstance.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                            if (points.length) {
                                const index = points[0].index;
                                updateRadarChart(index); // Update radar sesuai titik yg diklik
                            }
                        },
                        scales: {
                            y: { grid: { color: '#333' }, ticks: { color: '#aaa' } },
                            x: { grid: { display: false }, ticks: { color: '#aaa' } }
                        },
                        plugins: { legend: { display: false } }
                    }
                });

                // --- 2. RENDER RADAR CHART (Kanan) ---
                // Default: Tampilkan data Tryout TERAKHIR
                const lastIndex = allData.length - 1;
                initRadarChart(lastIndex);

            } catch (error) {
                console.error("Gagal load data:", error);
            }
        }

        function initRadarChart(index) {
            const ctxRadar = document.getElementById('radarChart').getContext('2d');
            const dataItem = allData[index];
            
            // Ambil nama subtes (Key) dan nilainya (Value)
            const subtestLabels = Object.keys(dataItem.detail);
            const subtestScores = Object.values(dataItem.detail);

            // Update Judul
            document.getElementById('radarTitle').innerText = "Detail: " + dataItem.tryout;

            radarChartInstance = new Chart(ctxRadar, {
                type: 'radar',
                data: {
                    labels: subtestLabels,
                    datasets: [{
                        label: 'Skor Subtes',
                        data: subtestScores,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: '#3b82f6',
                        pointBackgroundColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: { // Konfigurasi sumbu jari-jari
                            angleLines: { color: '#444' }, // Garis jaring
                            grid: { color: '#333' },
                            pointLabels: { color: '#fff', font: { size: 12 } }, // Label PU/PPU
                            ticks: { display: false, backdropColor: 'transparent' }, // Hilangkan angka grid biar bersih
                            suggestedMin: 0,
                            suggestedMax: 1000 // Skala UTBK (0-1000)
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // Fungsi Update Radar saat Line Chart diklik
        function updateRadarChart(index) {
            const dataItem = allData[index];
            const subtestScores = Object.values(dataItem.detail);
            
            // Ganti Data Radar
            radarChartInstance.data.datasets[0].data = subtestScores;
            document.getElementById('radarTitle').innerText = "Detail: " + dataItem.tryout;
            radarChartInstance.update();
        }

        // Jalankan
        initCharts();
    </script>

</body>
</html>
