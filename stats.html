<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistik Nilai - Nama Anda</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body>

    <nav>
        <div class="container nav-wrapper">
            <a href="index.html" class="logo">Nama.</a>
            <ul class="menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="projects.html">Karya</a></li>
                <li><a href="stats.html" class="active">Nilai TryOut</a></li>
                <li><a href="diary.html">Diary</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Progres Belajar</h1>
            <p>Klik titik pada grafik garis untuk melihat detail subtes.</p>
        </div>

       <div class="stats-grid">
    <div class="card">
        <h3>Skor Total</h3>
        <div style="height: 250px;"> <canvas id="lineChart"></canvas>
        </div>
    </div>

    <div class="card">
        <h3 id="radarTitle">Detail Subtes</h3>
        <div style="height: 250px;"> <canvas id="radarChart"></canvas>
        </div>
    </div>
</div>

        </div>
    </div>

    <footer>Â© 2026 Richy Firdaus.</footer>

    <script>
        // --- 3. AKTIFKAN PLUGIN ---
        Chart.register(ChartDataLabels);

        let lineChartInstance = null;
        let radarChartInstance = null;
        let allData = [];

        async function initCharts() {
            try {
                const response = await fetch('stats.json');
                allData = await response.json();

                const labels = allData.map(d => d.tryout);
                const scores = allData.map(d => d.skor);

                // --- KONFIGURASI LINE CHART (KIRI) ---
                const ctxLine = document.getElementById('lineChart').getContext('2d');
                let gradient = ctxLine.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, 'rgba(59, 130, 246, 0.5)'); 
                gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');   

                lineChartInstance = new Chart(ctxLine, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Total Skor',
                            data: scores,
                            borderColor: '#3b82f6',
                            backgroundColor: gradient,
                            borderWidth: 3,
                            pointBackgroundColor: '#1a1a1a',
                            pointBorderColor: '#3b82f6',
                            pointRadius: 6,
                            pointHoverRadius: 12,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: { padding: { top: 20 } }, // Beri ruang atas biar angka gak kepotong
                        onClick: (e) => {
                            const points = lineChartInstance.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                            if (points.length) {
                                updateRadarChart(points[0].index);
                            }
                        },
                        scales: {
                            y: { grid: { color: '#333' }, ticks: { color: '#aaa' } },
                            x: { grid: { display: false }, ticks: { color: '#aaa' } }
                        },
                        plugins: { 
                            legend: { display: false },
                            // --- SETTING ANGKA DI ATAS GARIS ---
                            datalabels: {
                                color: '#ffffff',
                                align: 'top',     // Posisi di atas titik
                                anchor: 'end',    // Jangkar di ujung titik
                                offset: 5,        // Jarak sedikit ke atas
                                font: { weight: 'bold', size: 12 },
                                formatter: Math.round // Bulatkan angka
                            }
                        }
                    }
                });

                // --- KONFIGURASI RADAR CHART (KANAN) ---
                const lastIndex = allData.length - 1;
                initRadarChart(lastIndex);

            } catch (error) {
                console.error("Gagal load data:", error);
            }
        }

        function initRadarChart(index) {
            const ctxRadar = document.getElementById('radarChart').getContext('2d');
            const dataItem = allData[index];
            const subtestLabels = Object.keys(dataItem.detail);
            const subtestScores = Object.values(dataItem.detail);

            document.getElementById('radarTitle').innerText = "Detail: " + dataItem.tryout;

            radarChartInstance = new Chart(ctxRadar, {
                type: 'radar',
                data: {
                    labels: subtestLabels,
                    datasets: [{
                        label: 'Skor',
                        data: subtestScores,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: '#3b82f6',
                        pointBackgroundColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#444' },
                            grid: { color: '#333' },
                            pointLabels: { color: '#fff', font: { size: 11 } },
                            ticks: { display: false },
                            suggestedMin: 0,
                            suggestedMax: 1000
                        }
                    },
                    plugins: { 
                        legend: { display: false },
                        // --- SETTING ANGKA DI RADAR ---
                        datalabels: {
                            color: '#ffffff',
                            backgroundColor: 'rgba(0,0,0,0.7)', // Kotak hitam transparan
                            borderRadius: 4,
                            padding: 4,
                            font: { size: 10 },
                            formatter: Math.round
                        }
                    }
                }
            });
        }

        function updateRadarChart(index) {
            const dataItem = allData[index];
            const subtestScores = Object.values(dataItem.detail);
            radarChartInstance.data.datasets[0].data = subtestScores;
            document.getElementById('radarTitle').innerText = "Detail: " + dataItem.tryout;
            radarChartInstance.update();
        }

        initCharts();
    </script>

</body>
</html>
